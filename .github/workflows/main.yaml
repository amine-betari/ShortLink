name: CD process for Symfony 5
on:
  push:
    branches: [ master ]

## Different pipelines
jobs:
  symfony:
    runs-on: ubuntu-latest
    env:
      SSHPASS: ${{ secrets.APP_PASS }}
    steps:
      # —— Setup Github actions 🐙 —————————————————————————————————————————————
      # https://github.com/actions/checkout (official)
      - name: "Checkout"
        uses: actions/checkout@v2

      - name: INSTALL SSHPASS
        run:
          sudo apt update && sudo apt install sshpass

      - name: Check PHP Version
        run: php -v

      # https://github.com/zhulik/redis-action (community)
      - name: Setup Redis with zhulik/redis-action
        uses: zhulik/redis-action@1.1.0
        with:
          redis version: '5'

      - name: deploy
        run:
          sshpass -e ssh -o stricthostkeychecking=no ${{ secrets.APP_USER }}@${{ secrets.APP_HOST }}
          "cd public_html/ &&
          git pull &&
          composer install &&
          php bin/console d:m:m -n"

      - name: PHPUnit for Symfony
        uses: chindit/actions-phpunit-symfony@master
        
      - name: PHPUnit
        uses: chindit/actions-phpunit-symfony@master